---
title: '1.6. Функции и структура программы'
metaTitle: 'Syntax Highlighting is the meta title tag for this page'
metaDescription: 'This is the meta description for this page'
---

Следующим уровнем в синтаксической структуре программы за выражениями и операторами является уровень функций. В отличие от предыдущих он является не только средством описания некоторой части программы, но и служит для оформления логически завершенного действия с собственным набором входных и выходных параметров. Термин функция, принятый в Си, имеет в других языках программирования родственные термины - процедура, модуль. Функция является основной программной единицей уже потому, что вся программа представляет собой множество вызывающих друг друга функций. Часть из них может быть получена «со стороны» - из библиотек или из программ, написанных в другое время, в другом месте, другими людьми и даже на другом языке программирования. То есть на уровне функций осуществляется «сборочный процесс» программы из отдельных составляющих.

Синтаксис определения и вызова функции

Синтаксис функций \(определения и вызова\) включает в себя до десятка терминов и определений, поэтому придется сначала договориться о терминологии, не вникая в суть, а затем обсуждать механизмы ее работы.

![рис. 16.1. Синтаксис определения и вызова функции](./assets/016-01.png)

Функция состоит из заголовка \(**1**\) и тела \(**2**\). **Заголовок функции –** это ее интерфейсная \(описательная\) часть, которая не дает программного кода, а содержит описание входных и выходных параметров, необходимых при ее выполнении \(вызове\). **Тело функции –** это программный код \(блок\), ограниченный фигурными скобками. Тело функции при трансляции преобразуется во внутреннее \(двоичное\) представление и размещается в сегменте команд программы \(см.**1.2**\). Существует также синтаксис, в котором присутствует только заголовок, ограниченный символом «**;**». В этом случае речь идет об **объявлении** функции – информировании транслятора о ее наличии и интерфейсе.

В заголовке находится **имя функции** \(**3**\), после которого в скобках – **список формальных параметров,** разделенных запятыми \(**4**\)**.** Список может быть и пустым. Синтаксис формального параметра \(**5**\) – это синтаксис определения переменной \(см.**1.3**\), что наводит на мысль, что формальные параметры – это особого рода переменные, которые используются для передачи параметров \(значений\) при вызове \(выполнении\) функции.

Внутри тела функции могут находиться определения обычных переменных \(**7**\), которые называются **локальными** \(в терминологии Си - автоматическими\). Тело каждой функции представляет собой отдельное изолированное пространство, в котором допустимо использование собственных переменных \(**9**\), составляющих неявное окружение – **контекст функции.** В него входят вышеуказанные формальные параметры и локальные переменные. Кроме того, контекст функции является короткоживущим: он создается при входе в функцию и разрушается при завершении ее выполнения.

Формальные параметры используются для передачи входных и выходных данных в функцию. Кроме них функция имеет еще одну неявную выходную переменную – **результат функции.** Результат функции - это временная переменная, которая возвращается функцией и может быть использована как операнд в той части выражения \(**13**\), где был произведен ее вызов \(**10**\).Как любая другая переменная, результат функции относится к определенному типу данных, который указан в заголовке функции \(**6**\). Это делается тем же способом, что и для обычных переменных. Используется тот же самый синтаксис, в котором имя функции выступает в роли переменной-результата. Тип результата может быть любым, за исключением функции или массива.\`\`

```c
int sum(...  // Результат - целая переменная
char *FF(... // Результат - указатель на символ
```

Значение переменной - результатa устанавливается в операторе **return \(8\)**, который производит это действие наряду с завершением выполнения функции и выходом из нее. Между ключевым словом **return** и ограничивающим символом ";" может стоять любое выражение, значение которого и становится результатом функции. Если вспомнить еще и о преобразованиях типов, то при таком «присваивании» результата таковое должно производиться от типа, соответствующего выражению к типу результата функции:

```c
double FF() {
    int nn;        // Эквивалент
    return (nn+1); // FF = (double)(nn + 1)
```

Имеется специальный пустой тип результата - **void**, который обозначает, что функция не возвращает никакого результата и, соответственно, не может быть вызвана внутри выражения. Оператор **return** в такой функции также не содержит никакого выражения. При вызове этой функции ее результат не может быть использован.

Определение функции представляет собой всего лишь статическую «заготовку» программы. Выполнение ее происходит тогда, когда в процессе вычисления выражения встречается вызов функции. Синтаксически **вызовом функции** называется упоминание имени этой функции в выражений \(**10**\), причем после имени функции в скобках следует список **фактических параметров \(12\).**

Фактические параметры – переменные, константы и выражения, которые ставятся в соответствие формальным параметрам при текущем вызове функции. По поводу них можно сказать следующее:

- между формальными и фактическими параметрами устанавливается «один-один» соответствие, которое действует только в течение текущего вызова функции \(динамически\);
- существуют различные способы установления соответствия, на настоящий момент реально распространенными в языках программирования являются способы передачи параметров **по ссылке** и **по значению;**
- фактические параметры имеются синтаксис выражения \(см **1.4**\). Это значит, что в них не определяются, а используются переменные и их сочетания, определенные в текущем контексте \(**11**\). Например, если определение массива имеет вид **int A\[\],** и в таком виде оно будет присутствовать в списке формальных параметров, то при вызове функции фактическим параметром может быть имя массива **C** определенного аналогичным образом \(т.е. переменная **C,** являющаяся массивом\).

В программе должна присутствовать функция \(**14**\), которая автоматически вызывается при загрузке программы в память и ее выполнении. Более никаких особенностей, кроме указанной, эта функция не имеет. Ее вид:

```c
void main() {...}
void main(void) {...}
void main(int narg, char *argv[]) {...}  // с интерфейсом командной строки
```

Способы соответствия формальных и фактических параметров

В настоящее время в большинстве языков программирования используются два способа передачи параметров: по ссылке и по значению. Особенностью Си является то, что он имеет возможность использовать ссылки не только неявно, но и с использованием такого архитектурно-ориентированного средства как указатель Кроме того, указатель и ссылка могут быть не только формальным параметром, но и результатом функции \(**5.2**\). Пока же мы ограничимся общепринятыми для всех языков программирования рамками.

**Передача параметра по значению** представляет собой **копирование** значения фактического параметра в формальный, т.е. является неявным присваиванием фактическому параметру значения формального. Этот способ обладает следующими свойствами:

- формальные параметры являются собственными переменными функции, аналогом локальных переменных;
- при вызове функции происходит присваивание формальным параметрам значений фактических \(копирование вторых в первые\);
- при изменении формальных параметров значения соответствующих им фактических параметров не меняются;
- передача параметров по значению используется для задании функции входных данных.

  **Передача параметра по ссылке** осуществляется **отображением** формального параметра в фактический:

- формальные параметры существуют как синонимы фактических, в этом смысле они не являются «настоящими» переменными, под которые отводится память, а реализуется как элемент отображения;
- при изменении значений формальных параметров эти изменения проецируются на соответствующие им фактические;
- передача параметров по ссылке может использоваться для данных, которые являются либо чисто выходными \(неявный результат функции\), либо представляют собой внешние для функции данные, которые она должна изменить.

![](../../.gitbook/assets/science.jpg) \*\*\*\*Доступ к объекту в виде значения \(копии\) и ссылки на оригинал широко используются в информационных технологиях. Для любого набора данных можно создать копию, передав ее пользователю, либо создать ссылку на оригинал. Например, на рабочем столе можно разместить копию файла \(аналог передачи по значению\), либо его ярлык \(аналог передачи по ссылке\).

В Си приняты следующие правила передачи, которые определяются синтаксическим видом формальных параметров в заголовке функции:

- по умолчанию \(т.е. при отсутствии явных символов обозначения\) все параметры, кроме массивов, передаются по значению, т.е. копируются;
- массивы передаются исключительно по ссылке, т.е. отображаются;
- для явного указания способа передачи параметра по ссылке служит символ «**&**», который записывается перед именем формального параметра.

Механизм вызова функции

Механизм вызова функции является динамическим, т.е. действия, связанные с его реализацией, осуществляются при выполнении программы. Именно поэтому текст программы и его «развертка» во времени представляют для функции «две большие разницы». Это касается двух вещей:

- последовательность выполняемых действий \(поток управления\) при вызовах функций:
- соответствие между формальными и фактическими параметрами.

Именно поэтому мы и рассмотрим процесс вызова вышеприведенной функции в «исторической перспективе»:

1. результатом трансляции функции является программный код, размещенный в сегменте команд;

2. в вызывающей функции \(**main**\) определяются переменные, используемые в качестве фактических параметров вызова функции \(массив **B**\);

3. выполняется программный код вызывающей функции, пока в ней не встретится выражение, содержащий вызов функции;

4. в соответствии со списком фактических параметров устанавливается соответствие между элементами контекста вызывающей функции и формальными параметрами;

![](./assets/016-02.png)

5. формальный параметр – массив **A** передается по ссылке - отображается на фактический параметр, аналогичный массив **B**, определенный в контексте вызывающей функции;

6. формальный параметр **n** – размерность массива **A** передается по значению, т.е. копируется, в качестве копируемого значения выступает константа;

7. сохраняется точка возврата в вызывающую функцию, после чего происходит переход к началу блока программного кода функции **sum**;

8. выполняется программный код функции **sum;**

9. в контексте вызываемой функции используются локальные переменные и формальные параметры, в соответствии со способами передачи параметров массив **A** отображается на исходный массив **B** в контексте **main;**

10. оператор **return** возвращает значение локальной переменной **s** в качестве переменной – результата в выражение, где находится вызов;

11. одновременно **return** производит переход в вызывающую функцию **main** в точку возврата;

12. продолжается выполнение программного кода вызывающей функции.
